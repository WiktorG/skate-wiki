cache:
  paths:
    - node_modules/
    - .yarn-cache

image: node

stages:
  - build-and-deploy

build-and-deploy:
  stage: build-and-deploy
  only:
    - master
  script:
    - yarn config set cache-folder .yarn-cache
    - yarn install --pure-lockfile
    - yarn build
    - ls -al build/
    - apt-get update -qq && apt-get install -y -qq lftp
    - lftp -c "set ftp:ssl-allow no; open -u $FTP_USERNAME,$FTP_PASSWORD $FTP_HOSTNAME; mirror -Rev build/ ./public_html  --ignore-time --parallel=10 --exclude-glob .git* --exclude .git/"
